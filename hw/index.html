<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Banana Neopardy - Button Monitor</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f0f0f0;
      }
      h1 {
        color: #333;
        text-align: center;
      }
      #connection-status {
        text-align: center;
        padding: 10px;
        margin: 20px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .connected {
        background-color: #4CAF50;
        color: white;
      }
      .disconnected {
        background-color: #f44336;
        color: white;
      }
      .button-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 20px 0;
      }
      .button-status {
        padding: 20px;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.2s;
      }
      .button-status.pressed {
        background-color: #ffeb3b;
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      .button-name {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .button-state {
        font-size: 14px;
        color: #666;
      }
      #event-log {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      #event-log h2 {
        margin-top: 0;
        font-size: 20px;
        color: #333;
      }
      .log-entry {
        padding: 5px 0;
        border-bottom: 1px solid #eee;
        font-size: 14px;
      }
      .log-entry:last-child {
        border-bottom: none;
      }
      .timestamp {
        color: #999;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Banana Neopardy - Button Monitor</h1>
      
      <div id="connection-status" class="disconnected">
        Disconnected
      </div>
      
      <div class="button-grid">
        <div class="button-status" id="player1-status">
          <div class="button-name">Player 1</div>
          <div class="button-state">Not Pressed</div>
        </div>
        <div class="button-status" id="player2-status">
          <div class="button-name">Player 2</div>
          <div class="button-state">Not Pressed</div>
        </div>
        <div class="button-status" id="player3-status">
          <div class="button-name">Player 3</div>
          <div class="button-state">Not Pressed</div>
        </div>
        <div class="button-status" id="correct-status">
          <div class="button-name">Correct</div>
          <div class="button-state">Not Pressed</div>
        </div>
        <div class="button-status" id="incorrect-status">
          <div class="button-name">Incorrect</div>
          <div class="button-state">Not Pressed</div>
        </div>
        <div class="button-status" id="next_question-status">
          <div class="button-name">Next Question</div>
          <div class="button-state">Not Pressed</div>
        </div>
      </div>
      
      <div id="event-log">
        <h2>Event Log</h2>
        <div id="log-entries"></div>
      </div>
    </main>
    
    <script>
      // WebSocket connection
      let ws = null;
      const maxLogEntries = 50;
      
      // Connect to WebSocket server
      function connectWebSocket() {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/ws`;
        
        console.log('Connecting to:', wsUrl);
        ws = new WebSocket(wsUrl);
        
        ws.onopen = function() {
          console.log('WebSocket connected');
          updateConnectionStatus(true);
        };
        
        ws.onmessage = function(event) {
          console.log('Received:', event.data);
          
          // Parse button data
          try {
            const data = JSON.parse(event.data);
            if (data.buttons && Array.isArray(data.buttons)) {
              handleButtonPresses(data.buttons);
            }
          } catch (e) {
            console.log('Non-JSON message received:', event.data);
          }
        };
        
        ws.onerror = function(error) {
          console.error('WebSocket error:', error);
        };
        
        ws.onclose = function() {
          console.log('WebSocket disconnected');
          updateConnectionStatus(false);
          // Attempt to reconnect after 3 seconds
          setTimeout(connectWebSocket, 3000);
        };
      }
      
      // Update connection status display
      function updateConnectionStatus(connected) {
        const statusDiv = document.getElementById('connection-status');
        if (connected) {
          statusDiv.textContent = 'Connected';
          statusDiv.className = 'connected';
        } else {
          statusDiv.textContent = 'Disconnected - Reconnecting...';
          statusDiv.className = 'disconnected';
        }
      }
      
      // Handle button press events
      function handleButtonPresses(buttons) {
        buttons.forEach(buttonName => {
          // Update button status display
          const statusDiv = document.getElementById(`${buttonName}-status`);
          if (statusDiv) {
            statusDiv.classList.add('pressed');
            
            // Remove pressed state after 300ms
            setTimeout(() => {
              statusDiv.classList.remove('pressed');
            }, 300);
          }
          
          // Add to event log
          addLogEntry(buttonName);
        });
      }
      
      // Add entry to event log
      function addLogEntry(buttonName) {
        const logEntries = document.getElementById('log-entries');
        const timestamp = new Date().toLocaleTimeString();
        
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> <strong>${formatButtonName(buttonName)}</strong> pressed`;
        
        // Add to top of log
        logEntries.insertBefore(entry, logEntries.firstChild);
        
        // Keep only last maxLogEntries
        while (logEntries.children.length > maxLogEntries) {
          logEntries.removeChild(logEntries.lastChild);
        }
      }
      
      // Format button name for display
      function formatButtonName(buttonName) {
        return buttonName.split('_').map(word => 
          word.charAt(0).toUpperCase() + word.slice(1)
        ).join(' ');
      }
      
      // Start WebSocket connection when page loads
      connectWebSocket();
    </script>
  </body>
</html>
